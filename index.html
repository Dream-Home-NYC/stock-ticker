<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Ticker Pro</title>
    <style>
        :root { --bg: #000; --panel: #1a1a1a; --text: #fff; --border: #333; }
        [data-theme="light"] { --bg: #fff; --panel: #f4f4f4; --text: #000; --border: #ccc; }
        
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Indices Header */
        #indices-header { height: 44px; width: 100%; border-bottom: 1px solid var(--border); overflow: hidden; }

        /* Ticker Banner */
        #ticker-wrap { width: 100%; background: var(--bg); padding: 12px 0; border-bottom: 2px solid var(--border); overflow: hidden; white-space: nowrap; }
        #ticker-move { display: inline-block; padding-left: 100%; animation: scroll 30s linear infinite; font-weight: bold; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        
        /* Pulse Alert */
        @keyframes subtle-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .stock-item { margin-right: 60px; font-size: 22px; display: inline-block; vertical-align: middle; }
        .up { color: #22ab94; } .down { color: #f23645; }
        .price-alert { animation: subtle-pulse 4s infinite ease-in-out; color: #ff9800 !important; }

        /* Auto-Hide Panel */
        #controls { padding: 15px; flex-grow: 1; transition: opacity 0.5s; opacity: 1; }
        .hidden { opacity: 0 !important; pointer-events: none; }
        .card { background: var(--panel); padding: 12px; border-radius: 6px; border: 1px solid var(--border); display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        input, button { padding: 8px; border-radius: 4px; border: 1px solid var(--border); background: var(--bg); color: var(--text); }
        button { cursor: pointer; font-weight: bold; background: #2962ff; color: #fff; border: none; }
        .stock-tag { display: inline-flex; background: var(--border); padding: 5px 10px; border-radius: 4px; margin: 3px; font-size: 12px; }
        .remove { color: #f23645; cursor: pointer; margin-left: 8px; font-weight: bold; }
    </style>
</head>
<body data-theme="dark">

<div id="indices-header">
    <div class="tradingview-widget-container">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://widgets.tradingview-widget.com/external-embedding/embed-widget-ticker-tape.js" async>
        {
        "symbols": [
            {"proName": "FOREXCOM:SPX500", "title": "S&P 500"},
            {"proName": "FOREXCOM:NSXUSD", "title": "Nasdaq Comp"},
            {"proName": "FOREXCOM:DJI", "title": "Dow Jones"}
        ],
        "showSymbolLogo": false, "colorTheme": "dark", "isTransparent": true, "displayMode": "adaptive", "locale": "en"
        }
        </script>
    </div>
</div>

<div id="ticker-wrap">
    <div id="ticker-move">Connecting...</div>
</div>

<div id="controls">
    <div class="card">
        <input type="text" id="new-stock" placeholder="Symbol">
        <button onclick="addStock()">ADD</button>
        <label>Size: <input type="number" id="f-size" value="22" style="width:45px" oninput="updateUI()"></label>
        <label>Speed: <input type="number" id="f-speed" value="30" style="width:45px" oninput="updateUI()"></label>
        <button onclick="toggleTheme()" style="background:#555">ðŸŒ“ Theme</button>
    </div>
    <div id="active-list"></div>
</div>

<script>
    const API_KEY = 'd60f5u1r01qto1rctdkgd60f5u1r01qto1rctdl0';
    let userStocks = JSON.parse(localStorage.getItem('stocks')) || ['NVDA', 'AAPL', 'TSLA'];
    let hideTimer;

    function resetTimer() {
        document.getElementById('controls').classList.remove('hidden');
        clearTimeout(hideTimer);
        hideTimer = setTimeout(() => document.getElementById('controls').classList.add('hidden'), 10000);
    }
    ['mousemove', 'touchstart', 'click'].forEach(e => window.addEventListener(e, resetTimer));
    resetTimer();

    async function fetchData(symbol) {
        try {
            const r = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEY}`);
            const d = await r.json();
            return d.c ? d : null;
        } catch { return null; }
    }

    async function refreshTicker() {
        const move = document.getElementById('ticker-move');
        let html = '';
        for (let s of userStocks) {
            const d = await fetchData(s);
            if (d) {
                const up = d.d >= 0;
                html += `<span class="stock-item ${Math.abs(d.dp) >= 2.0 ? 'price-alert' : ''}">
                    ${s} <span style="color:var(--text)">$${d.c.toFixed(2)}</span> 
                    <span class="${up ? 'up' : 'down'}">${up ? '+' : ''}${d.d.toFixed(2)} (${up ? '+' : ''}${d.dp.toFixed(2)}%)</span>
                </span>`;
            }
        }
        move.innerHTML = html;
        document.getElementById('active-list').innerHTML = userStocks.map(s => `
            <div class="stock-tag">${s}<span class="remove" onclick="removeStock('${s}')">Ã—</span></div>
        `).join('');
    }

    function addStock() {
        const i = document.getElementById('new-stock');
        const v = i.value.toUpperCase().trim();
        if (v && !userStocks.includes(v)) { userStocks.push(v); localStorage.setItem('stocks', JSON.stringify(userStocks)); i.value = ''; refreshTicker(); }
    }

    function removeStock(s) { userStocks = userStocks.filter(x => x !== s); localStorage.setItem('stocks', JSON.stringify(userStocks)); refreshTicker(); }

    function updateUI() {
        const m = document.getElementById('ticker-move');
        m.style.fontSize = document.getElementById('f-size').value + 'px';
        m.style.animationDuration = document.getElementById('f-speed').value + 's';
    }

    function toggleTheme() {
        const t = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', t);
        localStorage.setItem('theme', t);
    }
    document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');

    setInterval(refreshTicker, 60000);
    refreshTicker();
    updateUI();
</script>
</body>
</html>
