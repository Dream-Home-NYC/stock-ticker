<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamHome Market Command</title>
    <style>
        :root { --bg: #000; --panel: #1a1a1a; --text: #fff; --border: #333; --up: #00ff00; --down: #ff4444; --news: #00d4ff; --emerald: #50fa7b; --crimson: #ff5555; }
        [data-theme="light"] { --bg: #fff; --panel: #f4f4f4; --text: #000; --border: #ccc; }
        
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        .ticker-section { width: 100%; overflow: hidden; white-space: nowrap; border-bottom: 1px solid var(--border); background: var(--bg); cursor: pointer; display: flex; align-items: center; transition: background 0.5s ease; }
        #top-banner { padding: 6px 0; border-bottom: 2px solid #444; height: 40px; }
        #mid-banner { padding: 10px 0; border-bottom: 2px solid var(--border); height: 50px; }
        #news-banner { padding: 6px 0; background: #050505; border-bottom: 2px solid var(--news); height: 40px; position: relative; }

        /* Status Bar (18px fixed) */
        #market-status-bar { 
            background: var(--bg); padding: 0 15px; height: 100%; display: flex; 
            align-items: center; gap: 10px; border-right: 2px solid var(--border);
            z-index: 100; font-weight: bold; font-family: monospace; flex-shrink: 0; font-size: 18px;
        }
        #live-date { color: var(--up); }
        
        /* Countdown & Blinking Urgency */
        .cd-label { color: var(--news); } 
        .cd-timer { color: var(--up); }   
        @keyframes urgent-blink { 0%, 100% { color: var(--down); opacity: 1; } 50% { opacity: 0.3; } }
        .urgent-bell { animation: urgent-blink 1s infinite !important; }

        /* Economic Event Alerts */
        .event-alert { color: #000; font-weight: 900; background: #f1fa8c; padding: 0 10px; border-radius: 4px; margin-right: 50px; border: 1px solid #fff; display: inline-flex; align-items: center; }
        .volatility-warning { background: #f1fa8c !important; border-bottom: 2px solid #000 !important; }
        .volatility-warning .news-item { color: #000 !important; }

        .status-dot { width: 12px; height: 12px; border-radius: 50%; }
        .open-dot { background: var(--up); box-shadow: 0 0 8px var(--up); }
        .closed-dot { background: var(--down); box-shadow: 0 0 8px var(--down); }

        .scroller { display: inline-block; padding-left: 100%; animation: scroll linear infinite; font-weight: bold; line-height: 1.2; }
        .ticker-section:hover .scroller { animation-play-state: paused !important; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        
        .stock-item { margin-right: 60px; display: inline-block; vertical-align: middle; padding: 2px 8px; border-radius: 4px; }
        .news-item { margin-right: 100px; color: var(--news); font-style: italic; display: inline-block; }
        .up { color: var(--up); } .down { color: var(--down); }
        
        /* High Heat Formatting (>5% Move) */
        .heat-emerald { color: #000 !important; background: var(--emerald); border: 2px solid #fff; }
        .heat-crimson { color: #fff !important; background: var(--crimson); border: 2px solid #fff; }

        @keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .alert-gold { color: #FFD700 !important; animation: glow 2s infinite; }
        .alert-vix { color: #ff9800 !important; border: 1px solid #ff9800; padding: 0 5px; }

        #controls { padding: 15px; flex-grow: 1; transition: opacity 0.5s; opacity: 1; overflow-y: auto; }
        .card { background: var(--panel); padding: 12px; border-radius: 8px; border: 1px solid var(--border); display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        button { cursor: pointer; font-weight: bold; background: #2962ff; color: #fff; border: none; padding: 8px; border-radius: 4px; }
    </style>
</head>
<body data-theme="dark">

<div id="top-banner" class="ticker-section">
    <div id="market-status-bar">
        <span id="live-date">--/--/----</span>
        <span id="live-clock">00:00:00</span>
        <div id="status-indicator" class="status-dot closed-dot"></div>
        <span id="status-text" style="color:var(--down)">CLOSED</span>
        <span id="countdown-wrap">
            <span id="cd-text" class="cd-label"></span> 
            <span id="cd-time" class="cd-timer"></span>
        </span>
    </div>
    <div id="macro-scroller" class="scroller">Initializing Global Indices...</div>
</div>

<div id="mid-banner" class="ticker-section"><div id="portfolio-scroller" class="scroller">Syncing Stocks...</div></div>
<div id="news-banner" class="ticker-section"><div id="news-scroller" class="scroller">Syncing Business News...</div></div>

<div id="controls">
    <div class="card">
        <input type="text" id="new-stock" placeholder="Symbol" style="width:70px; background:#000; color:#fff; border:1px solid #333; padding:8px;">
        <button onclick="addStock()">ADD</button>
        <button onclick="refreshAll()" style="background:#222">ðŸ”„ REFRESH</button>
        <span id="last-sync" style="font-size:11px; color:#888; font-family:monospace;">Sync: --:--:--</span>
    </div>
</div>

<script>
    const FINNHUB_KEY = 'd60f5u1r01qto1rctdkgd60f5u1r01qto1rctdl0';
    const PROXY_URL = 'https://api.allorigins.win/get?url=';
    let userStocks = JSON.parse(localStorage.getItem('stocks')) || ['NVDA', 'AAPL', 'TSLA', 'VNQ', 'O'];

    const macroList = [
        { sym: '^DJI', name: 'DOW' }, { sym: '^IXIC', name: 'NASDAQ' }, { sym: '^GSPC', name: 'S&P 500' },
        { sym: 'GC=F', name: 'GOLD' }, { sym: 'SI=F', name: 'SILVER' }, { sym: 'CL=F', name: 'OIL' },
        { sym: 'BTC-USD', name: 'BTC' }, { sym: 'ETH-USD', name: 'ETH' }
    ];

    // --- Dynamic Macro Engine with Mortgage & VIX Logic ---
    async function refreshAll() {
        let tH = ''; 
        // 1. Standard Macro List
        for (let i of macroList) {
            const d = await fetchYahoo(i.sym);
            if (d) tH += formatItem(i.name, d, true);
        }
        
        // 2. Mortgage Rates (Color logic: Green if lower, Red if higher)
        const rates = [
            { name: '30-YR FIXED', rate: 6.78, change: -0.05 },
            { name: '15-YR FIXED', rate: 6.12, change: 0.02 }
        ];
        rates.forEach(r => {
            const isDown = r.change < 0; // "Better" for real estate is lower
            const colorClass = isDown ? 'up' : 'down'; // Using 'up' for green, 'down' for red
            tH += `<span class="stock-item">${r.name}: <span class="${colorClass}">${r.rate}% (${isDown?'':'+'}${r.change})</span></span>`;
        });

        // 3. VIX (Volatility Index) at the end
        const vixData = await fetchYahoo('^VIX');
        if (vixData) {
            const vixClass = vixData.price > 20 ? 'alert-vix' : '';
            tH += `<span class="stock-item ${vixClass}">VIX (FEAR): ${vixData.price.toFixed(2)} <span class="${vixData.change >= 0 ? 'down' : 'up'}">${vixData.change >= 0 ? '+' : ''}${vixData.percent.toFixed(2)}%</span></span>`;
        }

        document.getElementById('macro-scroller').innerHTML = tH;

        // Portfolio & News sections
        let mH = ''; for (let s of userStocks) { const d = await fetchFinnhub(s); if (d) mH += formatItem(s, d, false); }
        document.getElementById('portfolio-scroller').innerHTML = mH;

        const newsRes = await fetch(`https://finnhub.io/api/v1/news?category=general&token=${FINNHUB_KEY}`);
        const news = await newsRes.json();
        let newsH = `<span id="event-bubble" class="event-alert" style="display:none"></span>`;
        newsH += news.slice(0,10).map(h => `<span class="news-item">NEWS: ${h.headline.toUpperCase()}</span>`).join('');
        document.getElementById('news-scroller').innerHTML = newsH;
        
        document.getElementById('last-sync').innerText = `Sync: ${new Date().toLocaleTimeString()}`;
    }

    function formatItem(label, d, isMacro) {
        const isUp = d.change >= 0;
        let cls = "";
        if (!isMacro) {
            if (d.percent >= 5) cls = "heat-emerald";
            else if (d.percent <= -5) cls = "heat-crimson";
        }
        if (!cls && Math.abs(d.percent) >= 3.0) cls = (label === 'GOLD' ? 'alert-gold' : 'alert-macro');
        return `<span class="stock-item ${cls}">${label} $${d.price.toLocaleString(undefined, {minimumFractionDigits: 2})} <span class="${cls ? '' : (isUp ? 'up' : 'down')}">${isUp?'+':''}${d.percent.toFixed(2)}%</span></span>`;
    }

    // Standard Helper Functions
    async function fetchYahoo(symbol) {
        try { const res = await fetch(`${PROXY_URL}${encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`)}`); const json = await res.json(); const d = JSON.parse(json.contents).chart.result[0].meta; return { price: d.regularMarketPrice, change: d.regularMarketPrice - d.previousClose, percent: ((d.regularMarketPrice - d.previousClose) / d.previousClose) * 100 }; } catch (e) { return null; }
    }
    async function fetchFinnhub(symbol) {
        try { const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_KEY}`); const data = await res.json(); return data.c ? { price: data.c, change: data.d, percent: data.dp } : null; } catch (e) { return null; }
    }
    function updateClock() {
        const now = new Date();
        const est = new Intl.DateTimeFormat('en-US', { timeZone: 'America/New_York', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, year: 'numeric', month: '2-digit', day: '2-digit' }).formatToParts(now);
        document.getElementById('live-date').innerText = `${est.find(p => p.type === 'month').value}/${est.find(p => p.type === 'day').value}/${est.find(p => p.type === 'year').value}`;
        document.getElementById('live-clock').innerText = `${est.find(p => p.type === 'hour').value}:${est.find(p => p.type === 'minute').value}:${est.find(p => p.type === 'second').value}`;
    }
    function addStock() { const v = document.getElementById('new-stock').value.toUpperCase().trim(); if (v && !userStocks.includes(v)) { userStocks.push(v); localStorage.setItem('stocks', JSON.stringify(userStocks)); refreshAll(); } }

    setInterval(updateClock, 1000);
    setInterval(refreshAll, 60000);
    refreshAll();
</script>
</body>
</html>
